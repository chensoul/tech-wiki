

## 1. 建表规范

在命名数据库对象时，应该使用有意义的和易于理解的名称。以下是一些常见的命名规范：

表、字段命名

- 必须使用小写字母或数字
- 禁止出现数字开头
- 禁止两个下划线中间只出现数字
- 不适用复数名词
- 禁用保留字
- 是与否概念的字段，必须使用 is\_xxx 的方式命名

数据类型：

- 小数类型为decimal
- 货币数据使用最小货币单位，数据类型为bigint
- 字符串长度几乎相等使用char
- varchar长度不要超过5000

表必备三个字段：

- id
- create\_time
- update\_time

建表推荐规约：

- 表的命名最好是遵循“业务名称\_表的作用”

- 库名与应用名称尽量一致

- 如果修字段含义或对字段表示的状态追加时，需要及时更新字段注释

- 字段允许适当冗余，一提高查询性能，但必须考虑数据一致性

- 单表行数超过500万行或者单标容量超过2GB，才推荐进行分库分表

  

## 2. 索引规范

索引的分类：

- 存储形式：聚簇索引、非聚簇索引
- 数据约束：主键索引、唯一索引、非唯一索引
- 索引列的数量：单列索引、组合索引
- innoDB可以创建的索引：主键索引、唯一索引、普通索引

索引的数据结构：

- btree
- b+tree

索引名称规约：

- 索引命名：主键索引名为pk\_字段名、唯一索引名为uk\_字段名、普通的索引名则为idx\_字段名
- 创建索引规约：有唯一特性的字段必须成唯一索引、在varchar字段上建立索引时，必须指定索引长度、建组合索引的时候，区分度最高的在最左边

创建索引避免有如下极端误解：

- 索引宁滥勿缺：认为一个查询就需要建一个索引
- 吝啬索引创建：认为索引会消耗空间、严重拖慢记录的更新以及行的新增速度
- 抵制唯一索引：认为唯一索引一律需要在应用层通过先查后插方式解决

SQL规约-索引

- 注意字段类型：防止字段类型不同造成的隐士转换，导致索引失效
- 利用覆盖索引：利用覆盖索引来进行查询操作，避免回表
- 利用有序性：如果有order by的场景，请注意索引的有序性
- 禁模糊：页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决

SQL规约-count

- 拒绝替代：不要使用count(列名)或count(常量)来替代count(*)
- 计算不重复行数：count(distinct col)计算该列除NULL之外的不重复行数
- 当值全是NULL时，count(col)的返回结果为0，但sum(col)的返回结果为NULL

SQL规约-分页

- 若count为0，应该直接返回结果
- 优化超多分页场景：利用延迟关联或子查询优化超多分页场景

SQL规约-规避指南

- 不得使用外键与级联，一切外键概念必须在应用层解决
- 禁止使用存储过程，存储过程难以调试和扩展，更没有移植性
- 数据订正时，先select，避免出现误删除，确认无误才能执行更新语句
- 只要设计多个表，都需要在列明前加表的别名或表名进行限定
- SQL语句中标的别名前加as，并且以t1、t2、t3的顺序依次命名
- in后的集合元素数量，控制在1000个以内



## 3. SQL规范

在编写SQL语句时，应该考虑以下事项：

- 使用参数化查询：使用参数化查询可以避免SQL注入攻击和提高查询性能。
- 避免使用SELECT *：避免使用SELECT *可以减少不必要的数据传输和提高查询性能。
- 使用优化查询：使用优化查询可以提高查询性能和减少资源消耗。
- 避免使用子查询：避免使用子查询可以减少查询复杂性和提高查询性能。
- ORM映射规约：

  - 在表的查询中，一律不要使用 * 作为查询的字段列表
  - POJO类的布尔属性不能加is，而数据库字段必须加is\_
  - 查询结果都需要使用ResultMap映射
  - 不要使用${}
  - 不要使用MyBatis自带的queryForList
  - 不允许直接使用HashMap与Hashtable接收结果集
  - 更新数据库表记录时，必须同时更新update\_time
  - 不要写一个大而全的更新接口



## 4. 规范化

规范化是数据库设计的核心原则，将数据分解成合适的表和字段，避免数据冗余和不一致。具体来说，应该遵循第一范式（1NF）、第二范式（2NF）和第三范式（3NF），将数据分解成多个表，并使用外键约束和参照完整性规则，确保数据的一致性和完整性。同时，应该避免过度规范化，以免影响数据库性能和查询效率。

三大范式：

- 第一范式：每列属性不可拆分
- 第二范式：表中的每列都和主键相关
- 第三范式：每列都和主键列直接相关，而不是间接相关



## 5. 安全性

安全性是数据库设计的重要方面，应该采取一系列措施保护数据库的安全性。具体来说，应该遵循最小权限原则，限制用户的访问权限，避免误操作和数据泄露。应该使用加密算法保护敏感数据，避免数据泄露和安全漏洞。同时，应该对数据库进行定期检查和维护，以保证数据库的安全性和可靠性。



## 6. 文档和备份

文档和备份是数据库设计的重要方面，应该编写数据库设计文档，记录数据库结构、数据字典、索引和约束等信息，方便后续维护和升级。同时，应该定期备份数据库，以避免数据丢失和系统故障。备份数据应该存储在安全的地方，以免被恶意攻击者获取。
